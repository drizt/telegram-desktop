From 42f4e8d4fa25170d097db79d572aac5a3f2660d7 Mon Sep 17 00:00:00 2001
From: Ilya Fedin <fedin-ilja2010@ya.ru>
Date: Thu, 12 Nov 2020 19:10:30 +0400
Subject: [PATCH 2/2] Since changing the ibus portal check, it is not
 compatible with snap anymore

---
 Telegram/SourceFiles/platform/linux/specific_linux.cpp | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/Telegram/SourceFiles/platform/linux/specific_linux.cpp b/Telegram/SourceFiles/platform/linux/specific_linux.cpp
index 42c50074f..14264897a 100644
--- a/Telegram/SourceFiles/platform/linux/specific_linux.cpp
+++ b/Telegram/SourceFiles/platform/linux/specific_linux.cpp
@@ -1151,7 +1151,10 @@ void start() {
 	// Since tdesktop is distributed in static binary form,
 	// it makes sense to use ibus portal whenever it present
 	// to ensure compatibility with the maximum range of distributions.
-	if (IsIBusPortalPresent()) {
+	if (AreQtPluginsBundled()
+		&& !InFlatpak()
+		&& !InSnap()
+		&& IsIBusPortalPresent()) {
 		LOG(("IBus portal is present! Using it."));
 		qputenv("IBUS_USE_PORTAL", "1");
 	}
-- 
2.28.0

